{
  "id": "snapshot_1767376794298_cxxrchee8",
  "approvalId": "approval_1767376794286_zocz8l8mn",
  "approvalTitle": "Requirements: skillpkg v2.0 需求規格",
  "version": 1,
  "timestamp": "2026-01-02T17:59:54.298Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: skillpkg v2.0\n\n## Introduction\n\nskillpkg v2.0 transforms from a \"skill marketplace\" into a **Project AI Workflow Manager** - essentially a `package.json` for AI workflows. It provides a unified configuration file (`skillpkg.json`) to define project skills, MCP dependencies, and sync settings across multiple AI coding tools (Claude Code, Cursor, Codex, Copilot, Windsurf).\n\n**Problem Statement:**\n- AI coding assistants have different config locations and formats\n- Skills may depend on other skills or MCP servers (no dependency management)\n- No cross-tool compatibility - skills work in one tool but not another\n- No state tracking - unclear what's installed or why\n\n**Value Proposition:**\n- Define once in `skillpkg.json`, sync to all tools\n- Automatic dependency resolution (skill→skill, skill→MCP)\n- State tracking for installation history\n- Team-shareable configuration\n\n## Alignment with Product Vision\n\nskillpkg aims to be the standard package manager for AI agent skills. v2.0 focuses on:\n- **Project-centric workflow**: Skills defined per-project, not globally\n- **Cross-tool compatibility**: One config works across all AI tools\n- **Dependency management**: Like npm for skills\n\n## Requirements\n\n### Requirement 1: Project Configuration (skillpkg.json)\n\n**User Story:** As a developer, I want a single configuration file to define my project's AI skills, so that I can version control and share my AI workflow setup.\n\n#### Acceptance Criteria\n\n1. WHEN user runs `skillpkg init` THEN system SHALL create a `skillpkg.json` file with project name and empty skills/mcp sections\n2. WHEN `skillpkg.json` exists THEN system SHALL read skills, mcp, reminders, and sync_targets from it\n3. IF skill is installed THEN system SHALL update `skillpkg.json` with the skill source\n4. WHEN user edits `skillpkg.json` manually THEN system SHALL validate the format on next command\n\n### Requirement 2: Dependency Resolution\n\n**User Story:** As a developer, I want skills to automatically install their dependencies, so that I don't have to manually track what each skill needs.\n\n#### Acceptance Criteria\n\n1. WHEN skill has `dependencies.skills` in metadata THEN system SHALL resolve and install those skills first\n2. WHEN skill has `dependencies.mcp` in metadata THEN system SHALL prompt user to install required MCP servers\n3. IF circular dependency is detected THEN system SHALL abort and show error message\n4. WHEN dependency is installed THEN system SHALL record `installed_by` in state.json\n\n### Requirement 3: Sync Mechanism\n\n**User Story:** As a developer using multiple AI tools, I want to sync my skills to all tools with one command, so that my skills work consistently everywhere.\n\n#### Acceptance Criteria\n\n1. WHEN user runs `skillpkg sync` THEN system SHALL copy skills to all enabled targets in `sync_targets`\n2. WHEN syncing to Claude Code THEN system SHALL copy SKILL.md files to `.claude/skills/`\n3. WHEN syncing to Cursor THEN system SHALL copy skill files to `.cursor/rules/`\n4. WHEN syncing to Codex THEN system SHALL combine all skills into `AGENTS.md`\n5. WHEN syncing to Copilot THEN system SHALL combine skills into `.github/copilot-instructions.md`\n6. IF target has MCP config file THEN system SHALL update it with MCP dependencies\n\n### Requirement 4: State Tracking\n\n**User Story:** As a developer, I want to see what skills are installed and why, so that I can manage my project's AI dependencies.\n\n#### Acceptance Criteria\n\n1. WHEN skill is installed THEN system SHALL record in `state.json`: version, source, installed_by, installed_at, depended_by\n2. WHEN querying dependents THEN system SHALL return list of skills that depend on the queried skill\n3. WHEN uninstalling skill with dependents THEN system SHALL warn user and require confirmation\n4. WHEN skill is uninstalled THEN system SHALL update depended_by of its dependencies\n\n### Requirement 5: Uninstall with Dependency Check\n\n**User Story:** As a developer, I want to safely uninstall skills without breaking dependencies, so that I don't accidentally break other skills.\n\n#### Acceptance Criteria\n\n1. WHEN user runs `skillpkg uninstall <name>` THEN system SHALL check if other skills depend on it\n2. IF skill has dependents THEN system SHALL show warning with list of dependents\n3. WHEN `--force` flag is provided THEN system SHALL uninstall regardless of dependents\n4. WHEN skill is uninstalled THEN system SHALL identify orphan dependencies and offer to remove them\n\n### Requirement 6: CLI Commands\n\n**User Story:** As a developer, I want intuitive CLI commands to manage my project's AI workflow, so that I can quickly install, sync, and check status.\n\n#### Acceptance Criteria\n\n1. WHEN user runs `skillpkg init` THEN system SHALL interactively create skillpkg.json\n2. WHEN user runs `skillpkg install <source>` THEN system SHALL install skill with dependencies\n3. WHEN user runs `skillpkg sync [target]` THEN system SHALL sync to specified or all targets\n4. WHEN user runs `skillpkg status` THEN system SHALL show installed skills, MCP, and sync status\n5. WHEN user runs `skillpkg deps <name>` THEN system SHALL show skill's dependencies\n6. WHEN user runs `skillpkg why <name>` THEN system SHALL show who depends on this skill\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n- **Single Responsibility Principle**: ConfigManager, StateManager, DependencyResolver, Syncer as separate modules\n- **Modular Design**: Core library separate from CLI and MCP server\n- **Dependency Management**: Minimal external dependencies\n- **Clear Interfaces**: TypeScript interfaces for all data structures\n\n### Performance\n- Install single skill: < 5 seconds\n- Sync to all targets: < 2 seconds\n- State read: < 100ms\n\n### Cross-Platform Compatibility\n- Support macOS, Linux, Windows\n- No symlinks (use file copy for cross-platform)\n- Handle path differences between platforms\n\n### Backward Compatibility\n- v1.x skills work in v2.x\n- skill.yaml format still supported\n- SKILL.md format preferred\n\n### Error Handling\n- Clear error messages for missing dependencies\n- Prompt before overwriting existing files\n- Rollback on partial failure\n",
  "fileStats": {
    "size": 6152,
    "lines": 125,
    "lastModified": "2026-01-02T17:59:45.776Z"
  },
  "comments": []
}