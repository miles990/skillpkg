{
  "id": "snapshot_1767377813872_f7xntng3f",
  "approvalId": "approval_1767377813866_jdrgjioo7",
  "approvalTitle": "Tasks: skillpkg v2.0 任務清單 (7 Milestones, 30 Tasks)",
  "version": 1,
  "timestamp": "2026-01-02T18:16:53.872Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: skillpkg v2.0\n\n## Milestone 1: Config & State Management\n\n- [ ] 1.1 Define skillpkg.json JSON Schema\n  - File: packages/core/src/config/schemas/skillpkg.schema.json\n  - Create JSON Schema for skillpkg.json validation\n  - Include skills, mcp, reminders, hooks, sync_targets fields\n  - Purpose: Enable IDE autocomplete and validation\n  - _Leverage: packages/core/src/parser/schema.ts for reference_\n  - _Requirements: 1_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Schema Designer specializing in JSON Schema | Task: Create comprehensive JSON Schema for skillpkg.json following Requirement 1, supporting IDE autocomplete and validation | Restrictions: Follow JSON Schema draft-07 standard, ensure backward compatibility | Success: Schema validates all valid configs, rejects invalid ones, provides helpful error messages | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (schema fields, validation rules), then mark as [x]_\n\n- [ ] 1.2 Implement ConfigManager class\n  - File: packages/core/src/config/config-manager.ts\n  - Implement loadProjectConfig(), saveProjectConfig(), initProject()\n  - Add addSkill(), removeSkill() helper methods\n  - Purpose: Read/write skillpkg.json with validation\n  - _Leverage: packages/core/src/parser/validator.ts_\n  - _Requirements: 1_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: TypeScript Developer specializing in file I/O and validation | Task: Create ConfigManager class for skillpkg.json operations following Requirement 1 | Restrictions: Use ajv for validation, handle file not found gracefully | Success: Can read/write/validate skillpkg.json, proper error messages | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (class methods, interfaces), then mark as [x]_\n\n- [ ] 1.3 Define state.json schema and StateManager class\n  - File: packages/core/src/state/state-manager.ts\n  - Track skills (version, source, installed_by, depended_by)\n  - Track mcp (package, installed_by_skill)\n  - Track sync_history per target\n  - Purpose: Maintain installation state and dependency graph\n  - _Leverage: None (new module)_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer specializing in state management | Task: Create StateManager class for state.json following Requirement 4 | Restrictions: Atomic writes, handle concurrent access | Success: Can track/query skill states and dependencies | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (class methods, state schema), then mark as [x]_\n\n- [ ] 1.4 Add getDependents() and canUninstall() to StateManager\n  - File: packages/core/src/state/state-manager.ts (continue)\n  - getDependents(skillName): Returns skills that depend on this skill\n  - canUninstall(skillName): Check if safe to uninstall\n  - Purpose: Support dependency-aware uninstall\n  - _Leverage: packages/core/src/state/state-manager.ts_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Developer with graph algorithms expertise | Task: Add dependency query methods following Requirement 5 | Restrictions: O(n) complexity max, handle circular refs | Success: Correctly identifies all dependents | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (methods added), then mark as [x]_\n\n- [ ] 1.5 Write unit tests for ConfigManager and StateManager\n  - File: packages/core/src/config/__tests__/config-manager.test.ts\n  - File: packages/core/src/state/__tests__/state-manager.test.ts\n  - Test read/write operations, validation, edge cases\n  - Purpose: Ensure reliability of config/state management\n  - _Leverage: vitest testing framework_\n  - _Requirements: 1, 4_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer with TypeScript testing expertise | Task: Create comprehensive unit tests for ConfigManager and StateManager | Restrictions: Mock file system, test edge cases | Success: >80% coverage, all edge cases handled | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (test cases), then mark as [x]_\n\n## Milestone 2: Dependency Resolution\n\n- [ ] 2.1 Extend SKILL.md parser for dependencies field\n  - File: packages/core/src/parser/schema.ts (modify)\n  - Add dependencies: { skills?: string[], mcp?: string[] } to schema\n  - Update parser to extract dependencies from frontmatter\n  - Purpose: Support skill dependency declaration\n  - _Leverage: packages/core/src/parser/parser.ts_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Parser Developer | Task: Extend SKILL.md parser schema following Requirement 2 | Restrictions: Backward compatible, optional field | Success: Parses dependencies from existing and new skills | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (schema changes), then mark as [x]_\n\n- [ ] 2.2 Create DependencyResolver class\n  - File: packages/core/src/resolver/dependency-resolver.ts\n  - Implement resolveDependencies(source, installed): Recursive resolution\n  - Implement detectCircular(): Check for circular dependencies\n  - Purpose: Resolve skill→skill and skill→MCP dependencies\n  - _Leverage: packages/core/src/importer/importer.ts_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Algorithm Developer specializing in graph traversal | Task: Create DependencyResolver with recursive resolution and circular detection following Requirement 2 | Restrictions: Handle transitive deps, detect cycles early | Success: Correctly resolves dependency tree, aborts on circular | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (class methods, algorithms), then mark as [x]_\n\n- [ ] 2.3 Add MCP dependency checking\n  - File: packages/core/src/resolver/dependency-resolver.ts (continue)\n  - checkMcpDependencies(mcpNames): Check against .mcp.json\n  - Return missing MCP list with install instructions\n  - Purpose: Identify missing MCP servers\n  - _Leverage: packages/core/src/resolver/dependency-resolver.ts_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: MCP Integration Developer | Task: Add MCP dependency checking following Requirement 2 | Restrictions: Read .mcp.json, provide clear install instructions | Success: Correctly identifies missing MCPs | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (methods), then mark as [x]_\n\n- [ ] 2.4 Write unit tests for DependencyResolver\n  - File: packages/core/src/resolver/__tests__/dependency-resolver.test.ts\n  - Test single-level, multi-level, circular dependencies\n  - Test MCP dependency checking\n  - Purpose: Ensure correct dependency resolution\n  - _Leverage: vitest_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer | Task: Create tests for DependencyResolver | Restrictions: Mock skill fetching, test all scenarios | Success: All resolution scenarios tested | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (test cases), then mark as [x]_\n\n## Milestone 3: Sync Mechanism\n\n- [ ] 3.1 Define SyncTargetConfig for each AI tool\n  - File: packages/core/src/sync/targets.ts\n  - Define configs for: claude-code, cursor, codex, copilot, windsurf\n  - Include: skillsDir, mcpConfigFile, singleFile, transformer\n  - Purpose: Configure how skills sync to each tool\n  - _Leverage: packages/core/src/adapters/*.ts for reference_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Integration Developer | Task: Define sync target configurations following Requirement 3 | Restrictions: Follow each tool's conventions | Success: All 5 targets properly configured | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (target configs), then mark as [x]_\n\n- [ ] 3.2 Create Syncer class\n  - File: packages/core/src/sync/syncer.ts\n  - Implement syncToTarget(projectPath, target, skills)\n  - Implement syncAll(projectPath)\n  - Handle file copy and format conversion\n  - Purpose: Sync skills to AI tool directories\n  - _Leverage: packages/core/src/sync/targets.ts_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: File System Developer | Task: Create Syncer class following Requirement 3 | Restrictions: Atomic operations, handle errors gracefully | Success: Skills correctly synced to all targets | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (class methods), then mark as [x]_\n\n- [ ] 3.3 Implement format transformers\n  - File: packages/core/src/sync/transformers.ts\n  - SKILL.md → directory structure (Claude Code)\n  - SKILL.md → single file (Codex AGENTS.md, Copilot)\n  - Purpose: Convert skill format for each target\n  - _Leverage: packages/core/src/sync/syncer.ts_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Format Conversion Developer | Task: Create format transformers following Requirement 3 | Restrictions: Preserve skill content, handle frontmatter | Success: Correct format for each target | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (transformer functions), then mark as [x]_\n\n- [ ] 3.4 Add MCP config sync\n  - File: packages/core/src/sync/syncer.ts (continue)\n  - syncMcpConfig(projectPath, target, mcpConfig)\n  - Update .mcp.json / .cursor/mcp.json etc.\n  - Purpose: Sync MCP configuration to targets\n  - _Leverage: packages/core/src/sync/syncer.ts_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Config Sync Developer | Task: Add MCP config sync following Requirement 3 | Restrictions: Merge with existing config, don't overwrite user settings | Success: MCP config correctly synced | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (methods), then mark as [x]_\n\n- [ ] 3.5 Write unit tests for Syncer\n  - File: packages/core/src/sync/__tests__/syncer.test.ts\n  - Test sync to each target\n  - Test format transformation\n  - Test MCP config sync\n  - Purpose: Ensure correct sync behavior\n  - _Leverage: vitest, mock file system_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer | Task: Create tests for Syncer | Restrictions: Mock file system, test all targets | Success: All sync scenarios tested | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (test cases), then mark as [x]_\n\n## Milestone 4: Installer Updates\n\n- [ ] 4.1 Update install flow with dependency resolution\n  - File: packages/core/src/store/skill-store.ts (modify)\n  - Integrate DependencyResolver before installation\n  - Install dependencies in correct order\n  - Record installed_by in state.json\n  - Purpose: Auto-install skill dependencies\n  - _Leverage: packages/core/src/resolver/dependency-resolver.ts_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Package Manager Developer | Task: Update install flow following Requirement 2 | Restrictions: Maintain backward compat, atomic operations | Success: Dependencies auto-installed in order | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (flow changes), then mark as [x]_\n\n- [ ] 4.2 Update uninstall flow with dependency check\n  - File: packages/core/src/store/skill-store.ts (modify)\n  - Check dependents before uninstall\n  - Support --force flag\n  - Clean up orphan dependencies\n  - Purpose: Safe uninstall with dependency awareness\n  - _Leverage: packages/core/src/state/state-manager.ts_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Package Manager Developer | Task: Update uninstall flow following Requirement 5 | Restrictions: Warn before removing deps, support force | Success: Safe uninstall with orphan cleanup | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (flow changes), then mark as [x]_\n\n- [ ] 4.3 Implement installFromConfig()\n  - File: packages/core/src/store/skill-store.ts (continue)\n  - Read skillpkg.json and install all listed skills\n  - Similar to `npm install` from package.json\n  - Purpose: Install all project skills from config\n  - _Leverage: packages/core/src/config/config-manager.ts_\n  - _Requirements: 1_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Package Manager Developer | Task: Implement installFromConfig following Requirement 1 | Restrictions: Skip already installed, handle partial failures | Success: All config skills installed | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (method), then mark as [x]_\n\n- [ ] 4.4 Write integration tests for install/uninstall\n  - File: packages/core/src/store/__tests__/skill-store.integration.test.ts\n  - Test install with dependencies\n  - Test uninstall with dependents\n  - Test installFromConfig\n  - Purpose: Ensure correct install/uninstall behavior\n  - _Leverage: vitest_\n  - _Requirements: 2, 5_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer | Task: Create integration tests for install/uninstall | Restrictions: Use temp directories, clean up | Success: All scenarios tested | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (test cases), then mark as [x]_\n\n## Milestone 5: CLI Commands\n\n- [ ] 5.1 Add `skillpkg init` command\n  - File: packages/cli/src/commands/init.ts\n  - Interactive prompts for project name, sync targets\n  - Create skillpkg.json\n  - Purpose: Initialize new project with skillpkg\n  - _Leverage: packages/core/src/config/config-manager.ts_\n  - _Requirements: 6_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CLI Developer | Task: Create init command following Requirement 6 | Restrictions: Interactive prompts, handle existing config | Success: Creates valid skillpkg.json | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (command implementation), then mark as [x]_\n\n- [ ] 5.2 Add `skillpkg sync` command\n  - File: packages/cli/src/commands/sync.ts\n  - Support: skillpkg sync [target] --dry-run\n  - Show progress and results\n  - Purpose: Sync skills to AI tools\n  - _Leverage: packages/core/src/sync/syncer.ts_\n  - _Requirements: 6_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CLI Developer | Task: Create sync command following Requirement 6 | Restrictions: Support dry-run, show progress | Success: Syncs to all targets correctly | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (command implementation), then mark as [x]_\n\n- [ ] 5.3 Add dependency commands (deps, why, tree)\n  - File: packages/cli/src/commands/deps.ts\n  - skillpkg deps <name>: Show skill dependencies\n  - skillpkg why <name>: Show who depends on skill\n  - skillpkg tree: Show full dependency tree\n  - Purpose: Query dependency information\n  - _Leverage: packages/core/src/state/state-manager.ts_\n  - _Requirements: 6_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CLI Developer | Task: Create dependency query commands following Requirement 6 | Restrictions: Clear output format, handle missing skills | Success: Correct dependency info displayed | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (commands), then mark as [x]_\n\n- [ ] 5.4 Add `skillpkg status` command\n  - File: packages/cli/src/commands/status.ts\n  - Show installed skills with versions\n  - Show MCP status\n  - Show sync status per target\n  - Purpose: Overview of project AI workflow\n  - _Leverage: packages/core/src/state/state-manager.ts_\n  - _Requirements: 6_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CLI Developer | Task: Create status command following Requirement 6 | Restrictions: Clear table format, show warnings | Success: Complete status overview | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (command implementation), then mark as [x]_\n\n- [ ] 5.5 Update install/uninstall commands\n  - File: packages/cli/src/commands/install.ts (modify)\n  - File: packages/cli/src/commands/uninstall.ts (modify)\n  - Show dependency resolution output\n  - Add --force flag for uninstall\n  - Prompt for sync after install\n  - Purpose: Enhanced install/uninstall UX\n  - _Leverage: packages/core/src/store/skill-store.ts_\n  - _Requirements: 6_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: CLI Developer | Task: Update install/uninstall commands following Requirement 6 | Restrictions: Show deps, support force | Success: Clear feedback during install/uninstall | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (changes), then mark as [x]_\n\n## Milestone 6: MCP Server Updates\n\n- [ ] 6.1 Update install_skill MCP tool\n  - File: packages/mcp-server/src/tools/install.ts (modify)\n  - Return dependency info in result\n  - Return missing MCP list\n  - Prompt for sync\n  - Purpose: MCP tool reflects new features\n  - _Leverage: packages/core/src/store/skill-store.ts_\n  - _Requirements: 2, 6_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: MCP Developer | Task: Update install_skill tool | Restrictions: Maintain backward compat | Success: Returns deps and MCP info | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (tool changes), then mark as [x]_\n\n- [ ] 6.2 Update uninstall_skill MCP tool\n  - File: packages/mcp-server/src/tools/uninstall.ts (modify)\n  - Return dependents warning\n  - Support force parameter\n  - Purpose: MCP tool reflects uninstall changes\n  - _Leverage: packages/core/src/store/skill-store.ts_\n  - _Requirements: 5, 6_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: MCP Developer | Task: Update uninstall_skill tool | Restrictions: Return warnings, support force | Success: Safe uninstall via MCP | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (tool changes), then mark as [x]_\n\n- [ ] 6.3 Add sync_skills MCP tool\n  - File: packages/mcp-server/src/tools/sync.ts (new)\n  - Sync skills to specified target\n  - Return sync results\n  - Purpose: Enable sync via MCP\n  - _Leverage: packages/core/src/sync/syncer.ts_\n  - _Requirements: 3, 6_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: MCP Developer | Task: Create sync_skills tool | Restrictions: Support all targets | Success: Skills synced via MCP | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (new tool), then mark as [x]_\n\n## Milestone 7: Migration & Polish\n\n- [ ] 7.1 Implement migrate command\n  - File: packages/cli/src/commands/migrate.ts (new)\n  - Detect v1.x installations (skills without skillpkg.json)\n  - Generate skillpkg.json from installed skills\n  - Generate state.json\n  - Purpose: Smooth upgrade from v1.x\n  - _Leverage: packages/core/src/config/config-manager.ts_\n  - _Requirements: Non-functional: Backward Compatibility_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Migration Developer | Task: Create migrate command | Restrictions: Don't break existing installs | Success: v1.x users can upgrade smoothly | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (migration logic), then mark as [x]_\n\n- [ ] 7.2 Update README and documentation\n  - File: README.md (modify)\n  - File: docs/migration.md (new)\n  - Document skillpkg.json format\n  - Document sync targets\n  - Add migration guide\n  - Purpose: User documentation\n  - _Leverage: existing docs_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Update documentation | Restrictions: Clear examples, cover all features | Success: Users can understand and use v2.0 | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (docs), then mark as [x]_\n\n- [ ] 7.3 E2E testing\n  - File: packages/core/src/__tests__/e2e.test.ts (new)\n  - Test full workflow: init → install → sync → uninstall\n  - Test migration from v1.x\n  - Purpose: Validate complete user journeys\n  - _Leverage: vitest_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: E2E Test Engineer | Task: Create end-to-end tests | Restrictions: Test real workflows, clean up | Success: All user journeys validated | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (test scenarios), then mark as [x]_\n\n- [ ] 7.4 Version bump and release\n  - File: packages/*/package.json\n  - Bump versions to 0.3.0\n  - Update CHANGELOG.md\n  - npm publish\n  - Purpose: Release v2.0\n  - _Leverage: npm_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec skillpkg-v2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Release Engineer | Task: Prepare and execute release | Restrictions: Follow semver, update changelogs | Success: v0.3.0 published to npm | Instructions: Mark task as [-] in tasks.md before starting, use log-implementation tool after completion with artifacts (version changes), then mark as [x]_\n",
  "fileStats": {
    "size": 24574,
    "lines": 301,
    "lastModified": "2026-01-02T18:16:39.637Z"
  },
  "comments": []
}