{
  "id": "snapshot_1767345560356_1kqruuav1",
  "approvalId": "approval_1767345560352_xestr97y6",
  "approvalTitle": "MCP Server Tasks",
  "version": 1,
  "timestamp": "2026-01-02T09:19:20.356Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: skillpkg MCP Server\n\n## M1: 基礎設施\n\n- [ ] 1.1 建立 mcp-server 套件結構\n  - File: `packages/mcp-server/package.json`, `packages/mcp-server/tsconfig.json`\n  - 建立新的 monorepo 套件 `skillpkg-mcp-server`\n  - 加入依賴：`@modelcontextprotocol/sdk`, `skillpkg-core`\n  - Purpose: 建立 MCP Server 套件基礎架構\n  - _Leverage: packages/core/package.json, packages/cli/package.json_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: TypeScript Developer specializing in monorepo setup | Task: Implement the task for spec mcp-server, first run spec-workflow-guide to get the workflow guide. Create new package `skillpkg-mcp-server` under packages/mcp-server with proper package.json and tsconfig.json. Add dependencies: @modelcontextprotocol/sdk, skillpkg-core. Follow existing package patterns. | Restrictions: Must follow existing monorepo structure, use consistent versioning | Success: Package compiles, dependencies resolve correctly | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 1.2 定義 MCP 相關型別\n  - File: `packages/mcp-server/src/types.ts`\n  - 定義 ToolHandler interface、各 Tool 的 Input/Output types\n  - Purpose: 建立型別安全基礎\n  - _Leverage: design.md Data Models section_\n  - _Requirements: REQ-2 ~ REQ-8_\n  - _Prompt: Role: TypeScript Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create types.ts with ToolHandler interface and all tool input/output types as defined in design.md Data Models section. | Restrictions: Follow existing type patterns, export all types | Success: Types compile without errors, cover all tools | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 1.3 建立套件入口點\n  - File: `packages/mcp-server/src/index.ts`\n  - Export SkillpkgMcpServer class 和相關型別\n  - Purpose: 提供套件公開 API\n  - _Leverage: packages/core/src/index.ts_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: TypeScript Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create index.ts that exports SkillpkgMcpServer class and all public types. | Restrictions: Only export public API | Success: Package can be imported correctly | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n## M2: MCP Server 核心\n\n- [ ] 2.1 實作 MCP Server 主程式\n  - File: `packages/mcp-server/src/server.ts`\n  - 使用 @modelcontextprotocol/sdk 建立 Server\n  - 實作 stdio transport、tool registration\n  - Purpose: MCP Server 核心邏輯\n  - _Leverage: @modelcontextprotocol/sdk documentation_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: Backend Developer with MCP expertise | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create SkillpkgMcpServer class using @modelcontextprotocol/sdk. Implement start(), stop(), registerTools(). Use stdio transport. Log to stderr. | Restrictions: Must follow MCP protocol spec, handle errors gracefully | Success: Server starts/stops correctly, responds to MCP handshake | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 2.2 實作 Tool Router\n  - File: `packages/mcp-server/src/server.ts` (extend)\n  - 實作 tool call routing、參數驗證\n  - Purpose: 路由 MCP tool calls 到對應 handler\n  - _Leverage: existing server.ts from 2.1_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: Backend Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Extend server.ts to route tool calls to handlers. Add input validation using JSON schema. Return proper MCP responses. | Restrictions: Validate all inputs, return proper error format | Success: Tool calls routed correctly, invalid inputs rejected with error | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n## M3: Tool Handlers\n\n- [ ] 3.1 實作 search_skills handler\n  - File: `packages/mcp-server/src/tools/search-skills.ts`\n  - 搜尋本地 + Registry skills，回傳 metadata\n  - Purpose: 讓 AI 搜尋可用 skills\n  - _Leverage: skillpkg-core LocalStore, GlobalStore, RegistryClient_\n  - _Requirements: REQ-2_\n  - _Prompt: Role: Backend Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create search-skills.ts handler. Use LocalStore/GlobalStore for local search, RegistryClient for registry search. Support source filter (all/local/registry). Return metadata only (~100 tokens per skill). | Restrictions: Do not return full instructions, limit results | Success: Search returns matching skills from specified sources | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 3.2 實作 load_skill handler\n  - File: `packages/mcp-server/src/tools/load-skill.ts`\n  - 載入完整 skill instructions\n  - Purpose: 按需載入 skill 內容\n  - _Leverage: skillpkg-core LocalStore, GlobalStore, parse_\n  - _Requirements: REQ-3_\n  - _Prompt: Role: Backend Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create load-skill.ts handler. Load full skill instructions from store. Return id, name, version, description, instructions. Error if not installed. | Restrictions: Only load installed skills | Success: Returns full instructions for installed skill, error for missing | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 3.3 實作 install_skill handler\n  - File: `packages/mcp-server/src/tools/install-skill.ts`\n  - 從多種來源安裝 skills (Registry, GitHub, URL, Gist, Local)\n  - Purpose: 讓 AI 自主安裝新 skills\n  - _Leverage: skillpkg-core createInstaller, source detection from design.md_\n  - _Requirements: REQ-4_\n  - _Prompt: Role: Backend Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create install-skill.ts handler. Implement source detection (registry/github/gist/url/local). Use createInstaller for installation. Support scope option. | Restrictions: Validate sources, no code execution | Success: Installs from all supported sources, returns installed skill info | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 3.4 實作 list_skills handler\n  - File: `packages/mcp-server/src/tools/list-skills.ts`\n  - 列出已安裝 skills\n  - Purpose: 讓 AI 知道有哪些 skills\n  - _Leverage: skillpkg-core LocalStore, GlobalStore_\n  - _Requirements: REQ-5_\n  - _Prompt: Role: Backend Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create list-skills.ts handler. List skills from LocalStore and/or GlobalStore based on scope. Return metadata for each skill. | Restrictions: Filter by scope correctly | Success: Returns list of installed skills with metadata | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 3.5 實作 uninstall_skill handler\n  - File: `packages/mcp-server/src/tools/uninstall-skill.ts`\n  - 移除已安裝 skill\n  - Purpose: 讓 AI 管理 skills\n  - _Leverage: skillpkg-core LocalStore, GlobalStore_\n  - _Requirements: REQ-6_\n  - _Prompt: Role: Backend Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create uninstall-skill.ts handler. Remove skill from appropriate store. Return confirmation. | Restrictions: Error if skill not found | Success: Removes skill, returns confirmation | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 3.6 實作 search_registry handler\n  - File: `packages/mcp-server/src/tools/search-registry.ts`\n  - 搜尋遠端 Registry\n  - Purpose: 讓 AI 發現新 skills\n  - _Leverage: skillpkg-core RegistryClient_\n  - _Requirements: REQ-7_\n  - _Prompt: Role: Backend Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create search-registry.ts handler. Use RegistryClient to search. Return name, description, version, author, downloads. Support limit. | Restrictions: Handle registry unavailable gracefully | Success: Returns registry search results, graceful error on unavailable | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 3.7 實作 skill_info handler\n  - File: `packages/mcp-server/src/tools/skill-info.ts`\n  - 取得 skill 詳細資訊\n  - Purpose: 讓 AI 在安裝前了解 skill\n  - _Leverage: skillpkg-core RegistryClient_\n  - _Requirements: REQ-8_\n  - _Prompt: Role: Backend Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create skill-info.ts handler. Use RegistryClient to get full skill info. Return all metadata including readme if available. | Restrictions: Error if not found in registry | Success: Returns detailed skill info from registry | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 3.8 建立 tools index\n  - File: `packages/mcp-server/src/tools/index.ts`\n  - Export 所有 tool handlers\n  - Purpose: 統一 tools 入口\n  - _Leverage: all tool handlers from 3.1-3.7_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: TypeScript Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create tools/index.ts that exports all tool handlers as an array. | Restrictions: Export consistent format | Success: All handlers exported, can be imported by server | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n## M4: CLI 整合\n\n- [ ] 4.1 新增 serve command\n  - File: `packages/cli/src/commands/serve.ts`\n  - 實作 `skillpkg serve` command\n  - 支援 --scope, --project options\n  - Purpose: CLI 進入點啟動 MCP Server\n  - _Leverage: packages/cli/src/commands/*.ts patterns, skillpkg-mcp-server_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: CLI Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create serve.ts command using commander. Import and start SkillpkgMcpServer. Add --scope (local/global) and --project options. | Restrictions: Follow existing CLI patterns | Success: `skillpkg serve` starts MCP server correctly | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 4.2 註冊 serve command\n  - File: `packages/cli/src/cli.ts`\n  - 在 CLI 主程式註冊 serve command\n  - Purpose: 啟用 serve 功能\n  - _Leverage: existing command registrations in cli.ts_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: CLI Developer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Register serve command in cli.ts following existing patterns. | Restrictions: Follow existing registration pattern | Success: `skillpkg serve --help` shows command options | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 4.3 更新 CLI package.json\n  - File: `packages/cli/package.json`\n  - 加入 skillpkg-mcp-server 依賴\n  - Purpose: CLI 可使用 MCP Server\n  - _Leverage: existing dependencies_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: Package Manager | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Add skillpkg-mcp-server as dependency in CLI package.json. | Restrictions: Use correct version | Success: Dependencies install correctly | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n## M5: 測試\n\n- [ ] 5.1 建立 tool handler 單元測試\n  - File: `packages/mcp-server/src/__tests__/tools/*.test.ts`\n  - 測試每個 tool handler 的輸入驗證和輸出格式\n  - Purpose: 確保 tool handlers 正確運作\n  - _Leverage: vitest, mock stores_\n  - _Requirements: REQ-2 ~ REQ-8_\n  - _Prompt: Role: QA Engineer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create unit tests for all tool handlers. Mock stores and registry client. Test valid inputs, invalid inputs, error cases. | Restrictions: Mock external dependencies | Success: All handlers tested, edge cases covered | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 5.2 建立 MCP Server 整合測試\n  - File: `packages/mcp-server/src/__tests__/server.test.ts`\n  - 測試 MCP 協議流程\n  - Purpose: 確保 MCP 協議正確實作\n  - _Leverage: @modelcontextprotocol/sdk test utilities_\n  - _Requirements: REQ-1_\n  - _Prompt: Role: Integration Tester | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create integration tests for MCP server. Test tool listing, tool calls, error responses. | Restrictions: Test full MCP flow | Success: Server responds correctly to MCP protocol | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n## M6: 文件與發布\n\n- [ ] 6.1 更新 README\n  - File: `packages/mcp-server/README.md`\n  - 說明安裝、設定、使用方式\n  - Purpose: 使用者文件\n  - _Requirements: All_\n  - _Prompt: Role: Technical Writer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Create README.md with installation, configuration (claude_desktop_config.json example), and usage instructions. Document all available tools. | Restrictions: Clear and concise | Success: Users can set up and use MCP server | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 6.2 發布 skillpkg-mcp-server 到 npm\n  - Publish `skillpkg-mcp-server` package\n  - 更新 skillpkg-cli 版本\n  - Purpose: 公開發布\n  - _Requirements: All_\n  - _Prompt: Role: Release Manager | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Build and publish skillpkg-mcp-server to npm. Update skillpkg-cli to new version with serve command. | Restrictions: Test before publish | Success: Packages published, npm install works | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n\n- [ ] 6.3 更新 skillpkg skill.yaml\n  - File: `/Users/user/Workspace/skillpkg/skill.yaml`\n  - 新增 MCP Server 使用說明\n  - Purpose: 讓使用者透過 skill 學習 MCP 功能\n  - _Requirements: All_\n  - _Prompt: Role: Technical Writer | Task: Implement the task for spec mcp-server, first run spec-workflow-guide. Update skill.yaml instructions to include MCP Server setup and usage. | Restrictions: Keep concise | Success: skill.yaml includes MCP documentation | After completing: Mark task [-] → [x] in tasks.md, log implementation with log-implementation tool_\n",
  "fileStats": {
    "size": 14876,
    "lines": 182,
    "lastModified": "2026-01-02T09:19:09.772Z"
  },
  "comments": []
}